define("echarts/chart/bar",["require","./base","zrender/shape/Rectangle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","zrender/tool/color","../chart"],function(t){function e(t,e,o,n,r){i.call(this,t,e,o,n,r),this.refresh(n)}var i=t("./base"),o=t("zrender/shape/Rectangle");t("../component/axis"),t("../component/grid"),t("../component/dataZoom");var n=t("../config");n.bar={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,barMinHeight:0,barGap:"30%",barCategoryGap:"20%",itemStyle:{normal:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:!1}},emphasis:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:!1}}}};var r=t("../util/ecData"),s=t("zrender/tool/util"),a=t("zrender/tool/color");return e.prototype={type:n.CHART_TYPE_BAR,_buildShape:function(){this._buildPosition()},_buildNormal:function(t,e,i,r,s){for(var a,h,l,c,d,p,u,g,f,m,_,y,v=this.series,x=i[0][0],b=v[x],S="horizontal"==s,T=this.component.xAxis,C=this.component.yAxis,z=S?T.getAxis(b.xAxisIndex):C.getAxis(b.yAxisIndex),E=this._mapSize(z,i),L=E.gap,A=E.barGap,M=E.barWidthMap,w=E.barMaxWidthMap,k=E.barWidth,I=E.barMinHeightMap,O=E.interval,P=this.deepQuery([this.ecTheme,n],"island.r"),D=0,R=e;R>D&&null!=z.getNameByIndex(D);D++){S?c=z.getCoordByIndex(D)-L/2:d=z.getCoordByIndex(D)+L/2;for(var B=0,F=i.length;F>B;B++){var H=v[i[B][0]].yAxisIndex||0,N=v[i[B][0]].xAxisIndex||0;a=S?C.getAxis(H):T.getAxis(N),u=p=f=g=a.getCoord(0);for(var Y=0,W=i[B].length;W>Y;Y++)x=i[B][Y],b=v[x],_=b.data[D],y=this.getDataFromOption(_,"-"),r[x]=r[x]||{min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,sum:0,counter:0,average:0},l=Math.min(w[x]||Number.MAX_VALUE,M[x]||k),"-"!==y&&(y>0?(h=Y>0?a.getCoordSize(y):S?u-a.getCoord(y):a.getCoord(y)-u,1===W&&I[x]>h&&(h=I[x]),S?(p-=h,d=p):(c=p,p+=h)):0>y?(h=Y>0?a.getCoordSize(y):S?a.getCoord(y)-f:f-a.getCoord(y),1===W&&I[x]>h&&(h=I[x]),S?(d=g,g+=h):(g-=h,c=g)):(h=0,S?(p-=h,d=p):(c=p,p+=h)),r[x][D]=S?c+l/2:d-l/2,r[x].min>y&&(r[x].min=y,S?(r[x].minY=d,r[x].minX=r[x][D]):(r[x].minX=c+h,r[x].minY=r[x][D])),r[x].max<y&&(r[x].max=y,S?(r[x].maxY=d,r[x].maxX=r[x][D]):(r[x].maxX=c+h,r[x].maxY=r[x][D])),r[x].sum+=y,r[x].counter++,D%O===0&&(m=this._getBarItem(x,D,z.getNameByIndex(D),c,d-(S?0:l),S?l:h,S?h:l,S?"vertical":"horizontal"),this.shapeList.push(new o(m))));for(var Y=0,W=i[B].length;W>Y;Y++)x=i[B][Y],b=v[x],_=b.data[D],y=this.getDataFromOption(_,"-"),l=Math.min(w[x]||Number.MAX_VALUE,M[x]||k),"-"==y&&this.deepQuery([_,b,this.option],"calculable")&&(S?(p-=P,d=p):(c=p,p+=P),m=this._getBarItem(x,D,z.getNameByIndex(D),c,d-(S?0:l),S?l:P,S?P:l,S?"vertical":"horizontal"),m.hoverable=!1,m.draggable=!1,m.style.lineWidth=1,m.style.brushType="stroke",m.style.strokeColor=b.calculableHolderColor||this.ecTheme.calculableHolderColor||n.calculableHolderColor,this.shapeList.push(new o(m)));S?c+=l+A:d-=l+A}}this._calculMarkMapXY(r,i,S?"y":"x")},_buildHorizontal:function(t,e,i,o){return this._buildNormal(t,e,i,o,"horizontal")},_buildVertical:function(t,e,i,o){return this._buildNormal(t,e,i,o,"vertical")},_buildOther:function(t,e,i,n){for(var r=this.series,s=0,a=i.length;a>s;s++)for(var h=0,l=i[s].length;l>h;h++){var c=i[s][h],d=r[c],p=d.xAxisIndex||0,u=this.component.xAxis.getAxis(p),g=u.getCoord(0),f=d.yAxisIndex||0,m=this.component.yAxis.getAxis(f),_=m.getCoord(0);n[c]=n[c]||{min0:Number.POSITIVE_INFINITY,min1:Number.POSITIVE_INFINITY,max0:Number.NEGATIVE_INFINITY,max1:Number.NEGATIVE_INFINITY,sum0:0,sum1:0,counter0:0,counter1:0,average0:0,average1:0};for(var y=0,v=d.data.length;v>y;y++){var x=d.data[y],b=this.getDataFromOption(x,"-");if(b instanceof Array){var S,T,C=u.getCoord(b[0]),z=m.getCoord(b[1]),E=[x,d],L=this.deepQuery(E,"barWidth")||10,A=this.deepQuery(E,"barHeight");null!=A?(S="horizontal",b[0]>0?(L=C-g,C-=L):L=b[0]<0?g-C:0,T=this._getBarItem(c,y,b[0],C,z-A/2,L,A,S)):(S="vertical",b[1]>0?A=_-z:b[1]<0?(A=z-_,z-=A):A=0,T=this._getBarItem(c,y,b[0],C-L/2,z,L,A,S)),this.shapeList.push(new o(T)),C=u.getCoord(b[0]),z=m.getCoord(b[1]),n[c].min0>b[0]&&(n[c].min0=b[0],n[c].minY0=z,n[c].minX0=C),n[c].max0<b[0]&&(n[c].max0=b[0],n[c].maxY0=z,n[c].maxX0=C),n[c].sum0+=b[0],n[c].counter0++,n[c].min1>b[1]&&(n[c].min1=b[1],n[c].minY1=z,n[c].minX1=C),n[c].max1<b[1]&&(n[c].max1=b[1],n[c].maxY1=z,n[c].maxX1=C),n[c].sum1+=b[1],n[c].counter1++}}}this._calculMarkMapXY(n,i,"xy")},_mapSize:function(t,e,i){var o,n,r=this._findSpecialBarSzie(e,i),s=r.barWidthMap,a=r.barMaxWidthMap,h=r.barMinHeightMap,l=r.sBarWidthCounter,c=r.sBarWidthTotal,d=r.barGap,p=r.barCategoryGap,u=1;if(e.length!=l){if(i)o=t.getGap(),d=0,n=+(o/e.length).toFixed(2),0>=n&&(u=Math.floor(e.length/o),n=1);else if(o="string"==typeof p&&p.match(/%$/)?(t.getGap()*(100-parseFloat(p))/100).toFixed(2)-0:t.getGap()-p,"string"==typeof d&&d.match(/%$/)?(d=parseFloat(d)/100,n=+((o-c)/((e.length-1)*d+e.length-l)).toFixed(2),d=n*d):(d=parseFloat(d),n=+((o-c-d*(e.length-1))/(e.length-l)).toFixed(2)),0>=n)return this._mapSize(t,e,!0)}else if(o=l>1?"string"==typeof p&&p.match(/%$/)?+(t.getGap()*(100-parseFloat(p))/100).toFixed(2):t.getGap()-p:c,n=0,d=l>1?+((o-c)/(l-1)).toFixed(2):0,0>d)return this._mapSize(t,e,!0);return this._recheckBarMaxWidth(e,s,a,h,o,n,d,u)},_findSpecialBarSzie:function(t,e){for(var i,o,n,r,s=this.series,a={},h={},l={},c=0,d=0,p=0,u=t.length;u>p;p++)for(var g={barWidth:!1,barMaxWidth:!1},f=0,m=t[p].length;m>f;f++){var _=t[p][f],y=s[_];if(!e){if(g.barWidth)a[_]=i;else if(i=this.query(y,"barWidth"),null!=i){a[_]=i,d+=i,c++,g.barWidth=!0;for(var v=0,x=f;x>v;v++){var b=t[p][v];a[b]=i}}if(g.barMaxWidth)h[_]=o;else if(o=this.query(y,"barMaxWidth"),null!=o){h[_]=o,g.barMaxWidth=!0;for(var v=0,x=f;x>v;v++){var b=t[p][v];h[b]=o}}}l[_]=this.query(y,"barMinHeight"),n=null!=n?n:this.query(y,"barGap"),r=null!=r?r:this.query(y,"barCategoryGap")}return{barWidthMap:a,barMaxWidthMap:h,barMinHeightMap:l,sBarWidth:i,sBarMaxWidth:o,sBarWidthCounter:c,sBarWidthTotal:d,barGap:n,barCategoryGap:r}},_recheckBarMaxWidth:function(t,e,i,o,n,r,s,a){for(var h=0,l=t.length;l>h;h++){var c=t[h][0];i[c]&&i[c]<r&&(n-=r-i[c])}return{barWidthMap:e,barMaxWidthMap:i,barMinHeightMap:o,gap:n,barWidth:r,barGap:s,interval:a}},_getBarItem:function(t,e,i,o,n,s,h,l){var c,d=this.series,p=d[t],u=p.data[e],g=this._sIndex2ColorMap[t],f=[u,p],m=this.deepMerge(f,"itemStyle.normal"),_=this.deepMerge(f,"itemStyle.emphasis"),y=m.barBorderWidth;c={zlevel:this.getZlevelBase(),z:this.getZBase(),clickable:this.deepQuery(f,"clickable"),style:{x:o,y:n,width:s,height:h,brushType:"both",color:this.getItemStyleColor(this.deepQuery(f,"itemStyle.normal.color")||g,t,e,u),radius:m.barBorderRadius,lineWidth:y,strokeColor:m.barBorderColor},highlightStyle:{color:this.getItemStyleColor(this.deepQuery(f,"itemStyle.emphasis.color"),t,e,u),radius:_.barBorderRadius,lineWidth:_.barBorderWidth,strokeColor:_.barBorderColor},_orient:l};var v=c.style;c.highlightStyle.color=c.highlightStyle.color||("string"==typeof v.color?a.lift(v.color,-.3):v.color),v.x=Math.floor(v.x),v.y=Math.floor(v.y),v.height=Math.ceil(v.height),v.width=Math.ceil(v.width),y>0&&v.height>y&&v.width>y?(v.y+=y/2,v.height-=y,v.x+=y/2,v.width-=y):v.brushType="fill",c.highlightStyle.textColor=c.highlightStyle.color,c=this.addLabel(c,p,u,i,l);for(var x=[v,c.highlightStyle],b=0,S=x.length;S>b;b++){var T=x[b].textPosition;if("insideLeft"===T||"insideRight"===T||"insideTop"===T||"insideBottom"===T){var C=5;switch(T){case"insideLeft":x[b].textX=v.x+C,x[b].textY=v.y+v.height/2,x[b].textAlign="left",x[b].textBaseline="middle";break;case"insideRight":x[b].textX=v.x+v.width-C,x[b].textY=v.y+v.height/2,x[b].textAlign="right",x[b].textBaseline="middle";break;case"insideTop":x[b].textX=v.x+v.width/2,x[b].textY=v.y+C/2,x[b].textAlign="center",x[b].textBaseline="top";break;case"insideBottom":x[b].textX=v.x+v.width/2,x[b].textY=v.y+v.height-C/2,x[b].textAlign="center",x[b].textBaseline="bottom"}x[b].textPosition="specific",x[b].textColor=x[b].textColor||"#fff"}}return this.deepQuery([u,p,this.option],"calculable")&&(this.setCalculable(c),c.draggable=!0),r.pack(c,d[t],t,d[t].data[e],e,i),c},getMarkCoord:function(t,e){var i,o,n=this.series[t],r=this.xMarkMap[t],s=this.component.xAxis.getAxis(n.xAxisIndex),a=this.component.yAxis.getAxis(n.yAxisIndex);if(!e.type||"max"!==e.type&&"min"!==e.type&&"average"!==e.type)if(r.isHorizontal){i="string"==typeof e.xAxis&&s.getIndexByName?s.getIndexByName(e.xAxis):e.xAxis||0;var h=r[i];h=null!=h?h:"string"!=typeof e.xAxis&&s.getCoordByIndex?s.getCoordByIndex(e.xAxis||0):s.getCoord(e.xAxis||0),o=[h,a.getCoord(e.yAxis||0)]}else{i="string"==typeof e.yAxis&&a.getIndexByName?a.getIndexByName(e.yAxis):e.yAxis||0;var l=r[i];l=null!=l?l:"string"!=typeof e.yAxis&&a.getCoordByIndex?a.getCoordByIndex(e.yAxis||0):a.getCoord(e.yAxis||0),o=[s.getCoord(e.xAxis||0),l]}else{var c=null!=e.valueIndex?e.valueIndex:null!=r.maxX0?"1":"";o=[r[e.type+"X"+c],r[e.type+"Y"+c],r[e.type+"Line"+c],r[e.type+c]]}return o},refresh:function(t){t&&(this.option=t,this.series=t.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(t,e){function i(){f--,0===f&&e&&e()}for(var o=this.series,n={},s=0,a=t.length;a>s;s++)n[t[s][0]]=t[s];for(var h,l,c,d,p,u,g,f=0,s=this.shapeList.length-1;s>=0;s--)if(u=r.get(this.shapeList[s],"seriesIndex"),n[u]&&!n[u][3]&&"rectangle"===this.shapeList[s].type){if(g=r.get(this.shapeList[s],"dataIndex"),p=o[u],n[u][2]&&g===p.data.length-1){this.zr.delShape(this.shapeList[s].id);continue}if(!n[u][2]&&0===g){this.zr.delShape(this.shapeList[s].id);continue}"horizontal"===this.shapeList[s]._orient?(d=this.component.yAxis.getAxis(p.yAxisIndex||0).getGap(),c=n[u][2]?-d:d,h=0):(l=this.component.xAxis.getAxis(p.xAxisIndex||0).getGap(),h=n[u][2]?l:-l,c=0),this.shapeList[s].position=[0,0],f++,this.zr.animate(this.shapeList[s].id,"").when(this.query(this.option,"animationDurationUpdate"),{position:[h,c]}).done(i).start()}f||i()}},s.inherits(e,i),t("../chart").define("bar",e),e});