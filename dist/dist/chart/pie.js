define("echarts/chart/pie",["require","./base","zrender/shape/Text","zrender/shape/Ring","zrender/shape/Circle","zrender/shape/Sector","zrender/shape/Polyline","../config","../util/ecData","zrender/tool/util","zrender/tool/math","zrender/tool/color","../chart"],function(t){function e(t,e,o,n,r){i.call(this,t,e,o,n,r);var s=this;s.shapeHandler.onmouseover=function(t){var e=t.target,i=l.get(e,"seriesIndex"),o=l.get(e,"dataIndex"),n=l.get(e,"special"),r=[e.style.x,e.style.y],a=e.style.startAngle,h=e.style.endAngle,d=((h+a)/2+360)%360,c=e.highlightStyle.color,p=s.getLabel(i,o,n,r,d,c,!0);p&&s.zr.addHoverShape(p);var u=s.getLabelLine(i,o,r,e.style.r0,e.style.r,d,c,!0);u&&s.zr.addHoverShape(u)},this.refresh(n)}var i=t("./base"),o=t("zrender/shape/Text"),n=t("zrender/shape/Ring"),r=t("zrender/shape/Circle"),s=t("zrender/shape/Sector"),a=t("zrender/shape/Polyline"),h=t("../config");h.pie={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,center:["50%","50%"],radius:[0,"75%"],clockWise:!0,startAngle:90,minAngle:0,selectedOffset:10,itemStyle:{normal:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0,position:"outer"},labelLine:{show:!0,length:20,lineStyle:{width:1,type:"solid"}}},emphasis:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!1},labelLine:{show:!1,length:20,lineStyle:{width:1,type:"solid"}}}}};var l=t("../util/ecData"),d=t("zrender/tool/util"),c=t("zrender/tool/math"),p=t("zrender/tool/color");return e.prototype={type:h.CHART_TYPE_PIE,_buildShape:function(){var t=this.series,e=this.component.legend;this.selectedMap={},this._selected={};var i,o,s;this._selectedMode=!1;for(var a,d=0,c=t.length;c>d;d++)if(t[d].type===h.CHART_TYPE_PIE){if(t[d]=this.reformOption(t[d]),this.legendHoverLink=t[d].legendHoverLink||this.legendHoverLink,a=t[d].name||"",this.selectedMap[a]=e?e.isSelected(a):!0,!this.selectedMap[a])continue;i=this.parseCenter(this.zr,t[d].center),o=this.parseRadius(this.zr,t[d].radius),this._selectedMode=this._selectedMode||t[d].selectedMode,this._selected[d]=[],this.deepQuery([t[d],this.option],"calculable")&&(s={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{x:i[0],y:i[1],r0:o[0]<=10?0:o[0]-10,r:o[1]+10,brushType:"stroke",lineWidth:1,strokeColor:t[d].calculableHolderColor||this.ecTheme.calculableHolderColor||h.calculableHolderColor}},l.pack(s,t[d],d,void 0,-1),this.setCalculable(s),s=o[0]<=10?new r(s):new n(s),this.shapeList.push(s)),this._buildSinglePie(d),this.buildMark(d)}this.addShapeList()},_buildSinglePie:function(t){for(var e,i=this.series,o=i[t],n=o.data,r=this.component.legend,s=0,a=0,h=0,l=Number.NEGATIVE_INFINITY,d=[],c=0,p=n.length;p>c;c++)e=n[c].name,this.selectedMap[e]=r?r.isSelected(e):!0,this.selectedMap[e]&&!isNaN(n[c].value)&&(0!==+n[c].value?s++:a++,h+=+n[c].value,l=Math.max(l,+n[c].value));if(0!==h){for(var u,g,f,m,_,y,v=100,x=o.clockWise,b=(o.startAngle.toFixed(2)-0+360)%360,S=o.minAngle||.01,T=360-S*s-.01*a,C=o.roseType,c=0,p=n.length;p>c;c++)if(e=n[c].name,this.selectedMap[e]&&!isNaN(n[c].value)){if(g=r?r.getColor(e):this.zr.getColor(c),v=n[c].value/h,u="area"!=C?x?b-v*T-(0!==v?S:.01):v*T+b+(0!==v?S:.01):x?b-360/p:360/p+b,u=u.toFixed(2)-0,v=(100*v).toFixed(2),f=this.parseCenter(this.zr,o.center),m=this.parseRadius(this.zr,o.radius),_=+m[0],y=+m[1],"radius"===C?y=n[c].value/l*(y-_)*.8+.2*(y-_)+_:"area"===C&&(y=Math.sqrt(n[c].value/l)*(y-_)+_),x){var z;z=b,b=u,u=z}this._buildItem(d,t,c,v,n[c].selected,f,_,y,b,u,g),x||(b=u)}this._autoLabelLayout(d,f,y);for(var c=0,p=d.length;p>c;c++)this.shapeList.push(d[c]);d=null}},_buildItem:function(t,e,i,o,n,r,s,a,h,d,c){var p=this.series,u=((d+h)/2+360)%360,g=this.getSector(e,i,o,n,r,s,a,h,d,c);l.pack(g,p[e],e,p[e].data[i],i,p[e].data[i].name,o),t.push(g);var f=this.getLabel(e,i,o,r,u,c,!1),m=this.getLabelLine(e,i,r,s,a,u,c,!1);m&&(l.pack(m,p[e],e,p[e].data[i],i,p[e].data[i].name,o),t.push(m)),f&&(l.pack(f,p[e],e,p[e].data[i],i,p[e].data[i].name,o),f._labelLine=m,t.push(f))},getSector:function(t,e,i,o,n,r,a,h,l,d){var u=this.series,g=u[t],f=g.data[e],m=[f,g],_=this.deepMerge(m,"itemStyle.normal")||{},y=this.deepMerge(m,"itemStyle.emphasis")||{},v=this.getItemStyleColor(_.color,t,e,f)||d,x=this.getItemStyleColor(y.color,t,e,f)||("string"==typeof v?p.lift(v,-.2):v),b={zlevel:this.getZlevelBase(),z:this.getZBase(),clickable:this.deepQuery(m,"clickable"),style:{x:n[0],y:n[1],r0:r,r:a,startAngle:h,endAngle:l,brushType:"both",color:v,lineWidth:_.borderWidth,strokeColor:_.borderColor,lineJoin:"round"},highlightStyle:{color:x,lineWidth:y.borderWidth,strokeColor:y.borderColor,lineJoin:"round"},_seriesIndex:t,_dataIndex:e};if(o){var S=((b.style.startAngle+b.style.endAngle)/2).toFixed(2)-0;b.style._hasSelected=!0,b.style._x=b.style.x,b.style._y=b.style.y;var T=this.query(g,"selectedOffset");b.style.x+=c.cos(S,!0)*T,b.style.y-=c.sin(S,!0)*T,this._selected[t][e]=!0}else this._selected[t][e]=!1;return this._selectedMode&&(b.onclick=this.shapeHandler.onclick),this.deepQuery([f,g,this.option],"calculable")&&(this.setCalculable(b),b.draggable=!0),(this._needLabel(g,f,!0)||this._needLabelLine(g,f,!0))&&(b.onmouseover=this.shapeHandler.onmouseover),b=new s(b)},getLabel:function(t,e,i,n,r,s,a){var h=this.series,l=h[t],p=l.data[e];if(this._needLabel(l,p,a)){var u,g,f,m=a?"emphasis":"normal",_=d.merge(d.clone(p.itemStyle)||{},l.itemStyle),y=_[m].label,v=y.textStyle||{},x=n[0],b=n[1],S=this.parseRadius(this.zr,l.radius),T="middle";y.position=y.position||_.normal.label.position,"center"===y.position?(u=x,g=b,f="center"):"inner"===y.position||"inside"===y.position?(S=(S[0]+S[1])*(y.distance||.5),u=Math.round(x+S*c.cos(r,!0)),g=Math.round(b-S*c.sin(r,!0)),s="#fff",f="center"):(S=S[1]- -_[m].labelLine.length,u=Math.round(x+S*c.cos(r,!0)),g=Math.round(b-S*c.sin(r,!0)),f=r>=90&&270>=r?"right":"left"),"center"!=y.position&&"inner"!=y.position&&"inside"!=y.position&&(u+="left"===f?20:-20),p.__labelX=u-("left"===f?5:-5),p.__labelY=g;var C=new o({zlevel:this.getZlevelBase(),z:this.getZBase()+1,hoverable:!1,style:{x:u,y:g,color:v.color||s,text:this.getLabelText(t,e,i,m),textAlign:v.align||f,textBaseline:v.baseline||T,textFont:this.getFont(v)},highlightStyle:{brushType:"fill"}});return C._radius=S,C._labelPosition=y.position||"outer",C._rect=C.getRect(C.style),C._seriesIndex=t,C._dataIndex=e,C}},getLabelText:function(t,e,i,o){var n=this.series,r=n[t],s=r.data[e],a=this.deepQuery([s,r],"itemStyle."+o+".label.formatter");return a?"function"==typeof a?a.call(this.myChart,{seriesIndex:t,seriesName:r.name||"",series:r,dataIndex:e,data:s,name:s.name,value:s.value,percent:i}):"string"==typeof a?(a=a.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}").replace("{d}","{d0}"),a=a.replace("{a0}",r.name).replace("{b0}",s.name).replace("{c0}",s.value).replace("{d0}",i)):void 0:s.name},getLabelLine:function(t,e,i,o,n,r,s,h){var l=this.series,p=l[t],u=p.data[e];if(this._needLabelLine(p,u,h)){var g=h?"emphasis":"normal",f=d.merge(d.clone(u.itemStyle)||{},p.itemStyle),m=f[g].labelLine,_=m.lineStyle||{},y=i[0],v=i[1],x=n,b=this.parseRadius(this.zr,p.radius)[1]- -m.length,S=c.cos(r,!0),T=c.sin(r,!0);return new a({zlevel:this.getZlevelBase(),z:this.getZBase()+1,hoverable:!1,style:{pointList:[[y+x*S,v-x*T],[y+b*S,v-b*T],[u.__labelX,u.__labelY]],strokeColor:_.color||s,lineType:_.type,lineWidth:_.width},_seriesIndex:t,_dataIndex:e})}},_needLabel:function(t,e,i){return this.deepQuery([e,t],"itemStyle."+(i?"emphasis":"normal")+".label.show")},_needLabelLine:function(t,e,i){return this.deepQuery([e,t],"itemStyle."+(i?"emphasis":"normal")+".labelLine.show")},_autoLabelLayout:function(t,e,i){for(var o=[],n=[],r=0,s=t.length;s>r;r++)("outer"===t[r]._labelPosition||"outside"===t[r]._labelPosition)&&(t[r]._rect._y=t[r]._rect.y,t[r]._rect.x<e[0]?o.push(t[r]):n.push(t[r]));this._layoutCalculate(o,e,i,-1),this._layoutCalculate(n,e,i,1)},_layoutCalculate:function(t,e,i,o){function n(e,i,o){for(var n=e;i>n;n++)if(t[n]._rect.y+=o,t[n].style.y+=o,t[n]._labelLine&&(t[n]._labelLine.style.pointList[1][1]+=o,t[n]._labelLine.style.pointList[2][1]+=o),n>e&&i>n+1&&t[n+1]._rect.y>t[n]._rect.y+t[n]._rect.height)return void r(n,o/2);r(i-1,o/2)}function r(e,i){for(var o=e;o>=0&&(t[o]._rect.y-=i,t[o].style.y-=i,t[o]._labelLine&&(t[o]._labelLine.style.pointList[1][1]-=i,t[o]._labelLine.style.pointList[2][1]-=i),!(o>0&&t[o]._rect.y>t[o-1]._rect.y+t[o-1]._rect.height));o--);}function s(t,e,i,o,n){for(var r,s,a,h=i[0],l=i[1],d=n>0?e?Number.MAX_VALUE:0:e?Number.MAX_VALUE:0,c=0,p=t.length;p>c;c++)s=Math.abs(t[c]._rect.y-l),a=t[c]._radius-o,r=o+a>s?Math.sqrt((o+a+20)*(o+a+20)-Math.pow(t[c]._rect.y-l,2)):Math.abs(t[c]._rect.x+(n>0?0:t[c]._rect.width)-h),e&&r>=d&&(r=d-10),!e&&d>=r&&(r=d+10),t[c]._rect.x=t[c].style.x=h+r*n,t[c]._labelLine&&(t[c]._labelLine.style.pointList[2][0]=h+(r-5)*n,t[c]._labelLine.style.pointList[1][0]=h+(r-20)*n),d=r}t.sort(function(t,e){return t._rect.y-e._rect.y});for(var a,h=0,l=t.length,d=[],c=[],p=0;l>p;p++)a=t[p]._rect.y-h,0>a&&n(p,l,-a,o),h=t[p]._rect.y+t[p]._rect.height;this.zr.getHeight()-h<0&&r(l-1,h-this.zr.getHeight());for(var p=0;l>p;p++)t[p]._rect.y>=e[1]?c.push(t[p]):d.push(t[p]);s(c,!0,e,i,o),s(d,!1,e,i,o)},reformOption:function(t){var e=d.merge;return t=e(e(t||{},d.clone(this.ecTheme.pie||{})),d.clone(h.pie)),t.itemStyle.normal.label.textStyle=this.getTextStyle(t.itemStyle.normal.label.textStyle),t.itemStyle.emphasis.label.textStyle=this.getTextStyle(t.itemStyle.emphasis.label.textStyle),t},refresh:function(t){t&&(this.option=t,this.series=t.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(t,e){function i(){a--,0===a&&e&&e()}for(var o=this.series,n={},r=0,s=t.length;s>r;r++)n[t[r][0]]=t[r];var a=0,l={},d={},c={},p=this.shapeList;this.shapeList=[];for(var u,g,f,m={},r=0,s=t.length;s>r;r++)u=t[r][0],g=t[r][2],f=t[r][3],o[u]&&o[u].type===h.CHART_TYPE_PIE&&(g?(f||(l[u+"_"+o[u].data.length]="delete"),m[u]=1):f?m[u]=0:(l[u+"_-1"]="delete",m[u]=-1),this._buildSinglePie(u));for(var _,y,r=0,s=this.shapeList.length;s>r;r++)switch(u=this.shapeList[r]._seriesIndex,_=this.shapeList[r]._dataIndex,y=u+"_"+_,this.shapeList[r].type){case"sector":l[y]=this.shapeList[r];break;case"text":d[y]=this.shapeList[r];break;case"polyline":c[y]=this.shapeList[r]}this.shapeList=[];for(var v,r=0,s=p.length;s>r;r++)if(u=p[r]._seriesIndex,n[u]){if(_=p[r]._dataIndex+m[u],y=u+"_"+_,v=l[y],!v)continue;if("sector"===p[r].type)"delete"!=v?(a++,this.zr.animate(p[r].id,"style").when(400,{startAngle:v.style.startAngle,endAngle:v.style.endAngle}).done(i).start()):(a++,this.zr.animate(p[r].id,"style").when(400,m[u]<0?{startAngle:p[r].style.startAngle}:{endAngle:p[r].style.endAngle}).done(i).start());else if("text"===p[r].type||"polyline"===p[r].type)if("delete"===v)this.zr.delShape(p[r].id);else switch(p[r].type){case"text":a++,v=d[y],this.zr.animate(p[r].id,"style").when(400,{x:v.style.x,y:v.style.y}).done(i).start();break;case"polyline":a++,v=c[y],this.zr.animate(p[r].id,"style").when(400,{pointList:v.style.pointList}).done(i).start()}}this.shapeList=p,a||i()},onclick:function(t){var e=this.series;if(this.isClick&&t.target){this.isClick=!1;for(var i,o=t.target,n=o.style,r=l.get(o,"seriesIndex"),s=l.get(o,"dataIndex"),a=0,d=this.shapeList.length;d>a;a++)if(this.shapeList[a].id===o.id){if(r=l.get(o,"seriesIndex"),s=l.get(o,"dataIndex"),n._hasSelected)o.style.x=o.style._x,o.style.y=o.style._y,o.style._hasSelected=!1,this._selected[r][s]=!1;else{var p=((n.startAngle+n.endAngle)/2).toFixed(2)-0;o.style._hasSelected=!0,this._selected[r][s]=!0,o.style._x=o.style.x,o.style._y=o.style.y,i=this.query(e[r],"selectedOffset"),o.style.x+=c.cos(p,!0)*i,o.style.y-=c.sin(p,!0)*i}this.zr.modShape(o.id,o)}else this.shapeList[a].style._hasSelected&&"single"===this._selectedMode&&(r=l.get(this.shapeList[a],"seriesIndex"),s=l.get(this.shapeList[a],"dataIndex"),this.shapeList[a].style.x=this.shapeList[a].style._x,this.shapeList[a].style.y=this.shapeList[a].style._y,this.shapeList[a].style._hasSelected=!1,this._selected[r][s]=!1,this.zr.modShape(this.shapeList[a].id,this.shapeList[a]));this.messageCenter.dispatch(h.EVENT.PIE_SELECTED,t.event,{selected:this._selected,target:l.get(o,"name")},this.myChart),this.zr.refreshNextFrame()}}},d.inherits(e,i),t("../chart").define("pie",e),e});